"use client";

import { ApiContext } from "@/apicontext";
import { useContext } from 'react';
import { useQuery } from '@apollo/client';
import { GENE_EXPRESSION_QUERY, GENE_ID_QUERY } from './queries';
import { GeneExpressionQueryResponse, GeneIdQueryResponse } from './types';

export function useGeneExpressionData(assembly: string, gene_name: string) {
    const apiContext = useContext(ApiContext);

    if (!apiContext || !apiContext.client) {
        throw new Error("ApiContext client is not defined");
    }

    const client = apiContext.client;

    const { data, loading } = useQuery<GeneIdQueryResponse>(GENE_ID_QUERY, {
        client,
        variables: {
            gene_name,
            assembly,
        },
    });

    const geneId = data?.gene?.[0]?.id?.split('.')[0] || '';

    return useQuery<GeneExpressionQueryResponse>(GENE_EXPRESSION_QUERY, {
        client,
        variables:  {
            gene_id: geneId,
            assembly,
           /* accessions: assembly.toLowerCase() === "grch38" ?  [
                "ENCSR828TEI",
                "ENCSR919QJT",
                "ENCSR314LXG",
                "ENCSR429EWK",
                "ENCSR584JXD",
                "ENCSR196KBV",
                "ENCSR551NII",
                "ENCSR991HIR",
                "ENCSR964JRR",
                "ENCSR858QEL",
                "ENCSR880EGO",
                "ENCSR504NIU",
                "ENCSR648OSR",
                "ENCSR406SAW",
                "ENCSR313COD",
                "ENCSR719PXC",
                "ENCSR740YMS",
                "ENCSR528ZKN",
                "ENCSR244ISQ",
                "ENCSR052FJA",
                "ENCSR571RXE",
                "ENCSR080HPT",
                "ENCSR908ZAS",
                "ENCSR796HLX",
                "ENCSR158KFO",
                "ENCSR839ZDH",
                "ENCSR692DIM",
                "ENCSR971GPJ",
                "ENCSR136WGP",
                "ENCSR446LDS",
                "ENCSR444WHQ",
                "ENCSR568YRP",
                "ENCSR233IJT",
                "ENCSR332DBS",
                "ENCSR320BRR",
                "ENCSR336VTK",
                "ENCSR130TZW",
                "ENCSR735JKB",
                "ENCSR015PUN",
                "ENCSR559HWG",
                "ENCSR841QAC",
                "ENCSR306IAW",
                "ENCSR797BPP",
                "ENCSR343XXH",
                "ENCSR818DBU",
                "ENCSR931ATS",
                "ENCSR231ICM",
                "ENCSR113CCF",
                "ENCSR889IAP",
                "ENCSR870IUI",
                "ENCSR854VRX",
                "ENCSR267FRL",
                "ENCSR568UGZ",
                "ENCSR485WBR",
                "ENCSR729VMM",
                "ENCSR712BRU",
                "ENCSR945VLG",
                "ENCSR035SKV",
                "ENCSR761SHI",
                "ENCSR094RQC",
                "ENCSR800KLD",
                "ENCSR450BNZ",
                "ENCSR828JSJ",
                "ENCSR294AKN",
                "ENCSR108MAU",
                "ENCSR580GSX",
                "ENCSR653DFZ",
                "ENCSR669KQU",
                "ENCSR535VTR",
                "ENCSR894WMQ",
                "ENCSR379YAE",
                "ENCSR895ZTB",
                "ENCSR245ATJ",
                "ENCSR802HPM",
                "ENCSR257NIR",
                "ENCSR480SLD",
                "ENCSR645TCG",
                "ENCSR460YCS",
                "ENCSR321PGV",
                "ENCSR151NGC",
                "ENCSR774MGO",
                "ENCSR129VBC",
                "ENCSR631FXT",
                "ENCSR425RGZ",
                "ENCSR411MUF",
                "ENCSR355JZC",
                "ENCSR381OTM",
                "ENCSR201XOZ",
                "ENCSR398REC",
                "ENCSR589EBT",
                "ENCSR674KHG",
                "ENCSR759TPN",
                "ENCSR391VGU",
                "ENCSR701TST",
                "ENCSR410MSS",
                "ENCSR826FNO",
                "ENCSR003BTD",
                "ENCSR029KNZ",
                "ENCSR853WOM",
                "ENCSR379DEC",
                "ENCSR420ZKB",
                "ENCSR532LJV",
                "ENCSR229LFK",
                "ENCSR825UXP",
                "ENCSR797RXV",
                "ENCSR763OMY",
                "ENCSR019ICB",
                "ENCSR276MMH",
                "ENCSR146ZLV",
                "ENCSR687HJY",
                "ENCSR842NDO",
                "ENCSR609NZM",
                "ENCSR357BYU",
                "ENCSR151FXS",
                "ENCSR745APD",
                "ENCSR266PVZ",
                "ENCSR841ADZ",
                "ENCSR648YUM",
                "ENCSR140DCD",
                "ENCSR853TXT",
                "ENCSR429EGC",
                "ENCSR094VRQ",
                "ENCSR420YFF",
                "ENCSR857WJK",
                "ENCSR447WLU",
                "ENCSR827IXS",
                "ENCSR942YMN",
                "ENCSR652PHZ",
                "ENCSR132VGJ",
                "ENCSR352JCY",
                "ENCSR892LBU",
                "ENCSR619DQO",
                "ENCSR441IDG",
                "ENCSR278TQR",
                "ENCSR790BBE",
                "ENCSR146ZSP",
                "ENCSR897JEH",
                "ENCSR678TMV",
                "ENCSR676SRP",
                "ENCSR135IAL",
                "ENCSR621PZI",
                "ENCSR469WPG",
                "ENCSR876TAN",
                "ENCSR001HHK",
                "ENCSR045GTF",
                "ENCSR967JPI",
                "ENCSR903XMI",
                "ENCSR586SYA",
                "ENCSR438YPF",
                "ENCSR712GOC",
                "ENCSR801MKV",
                "ENCSR997KDB",
                "ENCSR403SZN",
                "ENCSR194HVU",
                "ENCSR838XNO",
                "ENCSR800WIY",
                "ENCSR344MQK",
                "ENCSR501DTN",
                "ENCSR911XSA",
                "ENCSR113HQM",
                "ENCSR275SNI",
                "ENCSR629HFE",
                "ENCSR320OTJ",
                "ENCSR434TEU",
                "ENCSR816HLU",
                "ENCSR098BUF",
                "ENCSR579KTN",
                "ENCSR244HHV",
                "ENCSR436QDU",
                "ENCSR985WSV",
                "ENCSR944UJZ",
                "ENCSR061HMO",
                "ENCSR291TRJ",
                "ENCSR365ARV",
                "ENCSR165QTZ",
                "ENCSR954PZB",
                "ENCSR882HXI",
                "ENCSR622PIH",
                "ENCSR111PSY",
                "ENCSR042GYH",
                "ENCSR252UHW",
                "ENCSR071DYD",
                "ENCSR450EXF",
                "ENCSR377MTB",
                "ENCSR968WKR",
                "ENCSR729CAZ",
                "ENCSR457ENP",
                "ENCSR272UNO",
                "ENCSR096UGR",
                "ENCSR131FDP",
                "ENCSR727DPU",
                "ENCSR075ZTG",
                "ENCSR544SAU",
                "ENCSR450ENK",
                "ENCSR653ZJF",
                "ENCSR558SEE",
                "ENCSR330UMQ",
                "ENCSR630VJN",
                "ENCSR226KML",
                "ENCSR563VMC",
                "ENCSR837VMK",
                "ENCSR584CVV",
                "ENCSR023ZXN",
                "ENCSR523RGW",
                "ENCSR464VSR",
                "ENCSR052LON",
                "ENCSR792OIJ",
                "ENCSR474TRG",
                "ENCSR420NLC",
                "ENCSR620LQN",
                "ENCSR033XWU",
                "ENCSR853BNH",
                "ENCSR185TQB",
                "ENCSR900FUP",
                "ENCSR516TTH",
                "ENCSR317HKT",
                "ENCSR368HRJ",
                "ENCSR927KSI",
                "ENCSR495HDM",
                "ENCSR516BJM",
                "ENCSR010HIU",
                "ENCSR924MSZ",
                "ENCSR395DKP",
                "ENCSR812AKX",
                "ENCSR837ZLY",
                "ENCSR862RGX",
                "ENCSR510MIA",
                "ENCSR863EIY",
                "ENCSR413QAL",
                "ENCSR755FNG",
                "ENCSR648KDM",
                "ENCSR733JBX",
                "ENCSR288RRZ",
                "ENCSR290IHM",
                "ENCSR168PXI",
                "ENCSR504QMK",
                "ENCSR096LTX",
                "ENCSR900SGE",
                "ENCSR896YYL",
                "ENCSR615EEK",
                "ENCSR074FTH",
                "ENCSR238ZZD",
                "ENCSR863VFU",
                "ENCSR377FPC",
                "ENCSR198QAJ",
                "ENCSR177XCG",
                "ENCSR071ZLM",
                "ENCSR563SJY",
                "ENCSR718RTN",
                "ENCSR394ZSF",
                "ENCSR479MNN",
                "ENCSR128CYL",
                "ENCSR585EUI",
                "ENCSR146LBD",
                "ENCSR698RPL",
                "ENCSR106SZN",
                "ENCSR351OTL",
                "ENCSR258ELN",
                "ENCSR631NUQ",
                "ENCSR899OKE",
                "ENCSR432EBE",
                "ENCSR394HJK",
                "ENCSR448BTT",
                "ENCSR500JSJ",
                "ENCSR773COB",
                "ENCSR073XFZ",
                "ENCSR820PHH",
                "ENCSR636LEU",
                "ENCSR570DQR",
                "ENCSR257FJF",
                "ENCSR146GSS",
                "ENCSR714CHF",
                "ENCSR034DEZ",
                "ENCSR266SBI",
                "ENCSR882RCG",
                "ENCSR681ARR",
                "ENCSR502PAY",
                "ENCSR197GCF",
                "ENCSR534OAS",
                "ENCSR296PMS",
                "ENCSR752UNJ",
                "ENCSR297AZN",
                "ENCSR235PLU",
                "ENCSR816IZA",
                "ENCSR915EBZ",
                "ENCSR562BUN",
                "ENCSR743GKS",
                "ENCSR354QPN",
                "ENCSR000AEL",
                "ENCSR956ZVR",
                "ENCSR184LTL",
                "ENCSR671IYC",
                "ENCSR579BDN",
                "ENCSR202OWR",
                "ENCSR025BZY",
                "ENCSR750ETS",
                "ENCSR078WNY",
                "ENCSR011VQI",
                "ENCSR471RUK",
                "ENCSR323GUF",
                "ENCSR308XAR",
                "ENCSR484WZL",
                "ENCSR182CBU",
                "ENCSR754WLW",
                "ENCSR094GVZ",
                "ENCSR938LSP"
              ] : [
                "ENCSR000AJV",
                "ENCSR004XCU",
                "ENCSR017JEG",
                "ENCSR020DGG",
                "ENCSR039ADS",
                "ENCSR049UJU",
                "ENCSR062VTB",
                "ENCSR080EVZ",
                "ENCSR095VGF",
                "ENCSR096STK",
                "ENCSR115TWD",
                "ENCSR150CUE",
                "ENCSR160IIN",
                "ENCSR173PJN",
                "ENCSR178GUS",
                "ENCSR185LWM",
                "ENCSR216NEG",
                "ENCSR284AMY",
                "ENCSR284YKY",
                "ENCSR285WZV",
                "ENCSR304RDL",
                "ENCSR307BCA",
                "ENCSR331XCE",
                "ENCSR337FYI",
                "ENCSR343YLB",
                "ENCSR347SQR",
                "ENCSR362AIZ",
                "ENCSR367ZPZ",
                "ENCSR370SFB",
                "ENCSR401BSG",
                "ENCSR420QTO",
                "ENCSR438XCG",
                "ENCSR442XRH",
                "ENCSR448MXQ",
                "ENCSR457RRW",
                "ENCSR465PBJ",
                "ENCSR466KZY",
                "ENCSR508GWZ",
                "ENCSR526SEX",
                "ENCSR537GNQ",
                "ENCSR538WYL",
                "ENCSR541XZK",
                "ENCSR557RMA",
                "ENCSR559TRB",
                "ENCSR597UZW",
                "ENCSR611PTP",
                "ENCSR636CWO",
                "ENCSR647QBV",
                "ENCSR648YEP",
                "ENCSR691OPQ",
                "ENCSR712PLG",
                "ENCSR719NAJ",
                "ENCSR727FHP",
                "ENCSR748DUR",
                "ENCSR750YSX",
                "ENCSR752RGN",
                "ENCSR760TOE",
                "ENCSR764OPZ",
                "ENCSR792RJV",
                "ENCSR795WFC",
                "ENCSR809VYL",
                "ENCSR823VEE",
                "ENCSR826HIQ",
                "ENCSR830IVQ",
                "ENCSR848GST",
                "ENCSR848HOX",
                "ENCSR851HEC",
                "ENCSR867YNV",
                "ENCSR906YQZ",
                "ENCSR908JWT",
                "ENCSR921PRX",
                "ENCSR932TRU",
                "ENCSR943LKA",
                "ENCSR968QHO",
                "ENCSR970EWM",
                "ENCSR982MRY",
                "ENCSR992WBR",
                "ENCSR996TVY"
              ]*/
        },
        skip: loading || !data || !geneId,
    });
}
